"use strict";(globalThis["webpackChunkogame_tracker"]=globalThis["webpackChunkogame_tracker"]||[]).push([[6439],{3445:(e,t,i)=>{function s(e,t){const i=["galaxy","system","position","type"];for(const s of i){const i=e[s]-t[s];if(0!=i)return i}return 0}function n(e,t){return 0==s(e,t)}i.d(t,{e:()=>s,a:()=>n})},6439:(e,t,i)=>{i.r(t),i.d(t,{default:()=>M});var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"point-distribution"},[i("grid-table",{attrs:{columns:e.columns,items:e.items,footerItems:e.footerItems,inline:""},scopedSlots:e._u([{key:"cell-points",fn:function(e){var t=e.value;return[i("decimal-number",{attrs:{value:t}})]}},{key:"footer-points",fn:function(e){var t=e.value;return[i("decimal-number",{attrs:{value:t}})]}}])}),i("grid-table",{attrs:{columns:e.columns,items:e.highscoreItems,footerItems:e.highscoreFooterItems,inline:""},scopedSlots:e._u([{key:"cell-points",fn:function(e){var t=e.value;return[i("decimal-number",{attrs:{value:t}})]}},{key:"footer-points",fn:function(e){var t=e.value;return[i("decimal-number",{attrs:{value:t}})]}}])})],1)},n=[],o=i(655),r=i(6864),l=i(1913),c=i(130),u=i(3445),a=i(5128),h=i(1628),f=i(5794),g=i(6119),d=i(2816),m=i(9681),p=i(4846),P=i(1731),v=i(248),b=i(4028),A=i(8395),y=i(6903),B=i(7076);let C=class extends b.w3{get columns(){return[{key:"label",label:"LOCA: Category"},{key:"points",label:"LOCA: Points"}]}get pointDistribution(){const e=this.researchPoints,t={research:e,planetBuildings:0,moonBuildings:0,lifeformBuildingsActive:0,lifeformBuildingsInactive:0,lifeformTechnologiesActive:0,lifeformTechnologiesInactive:0,defense:0,ships:0,shipsInTransit:this.fleetsShipPoints,total:e};return this.planetPointDistributions.forEach((e=>{t.planetBuildings+=e.buildings,t.lifeformBuildingsActive+=e.lifeformBuildingsActive,t.lifeformBuildingsInactive+=e.lifeformBuildingsInactive,t.lifeformTechnologiesActive+=e.lifeformTechnologiesActive,t.lifeformTechnologiesInactive+=e.lifeformTechnologiesInactive,t.defense+=e.defense,t.ships+=e.ships,Object.keys(e).forEach((i=>{"planetId"!=i&&(t.total+=e[i])}))})),this.moonPointDistributions.forEach((e=>{t.moonBuildings+=e.buildings,t.defense+=e.defense,t.ships+=e.ships,Object.keys(e).forEach((i=>{"moonId"!=i&&(t.total+=e[i])}))})),t}get highscorePoints(){return{economy:this.getEconomyPoints(),research:this.researchPoints,military:this.getMilitaryPoints(),lifeforms:this.getLifeformPoints()}}get highscoreItems(){const{economy:e,research:t,military:i,lifeforms:s}=this.highscorePoints,n=[{label:"LOCA: Economy",points:e},{label:"LOCA: Research",points:t},{label:"LOCA: Military",points:i}];return B.s.serverSettings.lifeforms.enabled&&n.push({label:"LOCA: Lifeforms",points:s}),n}get highscoreFooterItems(){const e=Object.values(this.highscorePoints).reduce(((e,t)=>e+t),0);return[{label:"LOCA: Total Points",points:e}]}get items(){const e=this.pointDistribution,t=[{label:"LOCA: Planet Buildings",points:e.planetBuildings}];return B.s.serverSettings.lifeforms.enabled&&t.push({label:"LOCA: Lifeform Buildings (active)",points:e.lifeformBuildingsActive},{label:"LOCA: Lifeform Buildings (inactive)",points:e.lifeformBuildingsInactive},{label:"LOCA: Lifeform Technologiess (active)",points:e.lifeformTechnologiesActive},{label:"LOCA: Lifeform Technologiess (inactive)",points:e.lifeformTechnologiesInactive}),t.push({label:"LOCA: Moon Buildings",points:e.moonBuildings},{label:"LOCA: Research",points:e.research},{label:"LOCA: Defense",points:e.defense},{label:"LOCA: Ships",points:e.ships},{label:"LOCA: Ships in transit",points:e.shipsInTransit}),t}get footerItems(){return[{label:"LOCA: Actual Total Points",points:this.pointDistribution.total}]}get planets(){return this.planetAndMoons.filter((e=>!e.isMoon))}get planetAndMoons(){return Object.values(A.p.empire.planets)}getLifeformPoints(){const e=this.planets.reduce(((e,t)=>{const i=d.YS.reduce(((e,i)=>{const s=g.ry[i],n=this.getAccumulativeCost(t.lifeformBuildings[i],s);return e+this.getPoints(n)}),0);return e+i}),0),t=this.planets.reduce(((e,t)=>{const i=m.Vs.reduce(((e,i)=>{const s=p.dy[i],n=this.getAccumulativeCost(t.lifeformTechnologies[i],s);return e+this.getPoints(n)}),0);return e+i}),0),i=Object.values(y.F.lifeforms).reduce(((e,t)=>e+t.discoveriesCount),0);return e+t+i}getEconomyPoints(){const e=this.planets.reduce(((e,t)=>e+this.getDefensePoints(t)),0),t=this.planetAndMoons.filter((e=>e.isMoon)).reduce(((e,t)=>{const i=this.getAccumulativeCost(t.buildings[r.A.sensorPhalanx],c.T),s=this.getAccumulativeCost(t.buildings[r.A.jumpGate],c.T),n=this.getPoints(i)+this.getPoints(s);return e+n}),0),i=v.v6.filter((e=>v.XZ.includes(e))),s=this.planetAndMoons.reduce(((e,t)=>{let i;return i=t.isMoon?v.Hf.filter((e=>v.XZ.includes(e))).reduce(((e,i)=>{const s=v.lp[i],n=(0,a.fB)(s.cost,t.ships[i]);return e+this.getPoints(n)}),0):v.oN.filter((e=>v.XZ.includes(e))).reduce(((e,i)=>{const s=v.lp[i],n=(0,a.fB)(s.cost,t.ships[i]);return e+this.getPoints(n)}),0),e+i}),0)+this.ownReturningFleets.reduce(((e,t)=>{const s=i.reduce(((e,i)=>{const s=t.ships[i],n=v.lp[i],o=(0,a.fB)(n.cost,s);return e+this.getPoints(o)}),0);return e+s}),0),n=this.planetAndMoons.reduce(((e,t)=>{let i;return i=t.isMoon?l.RP.reduce(((e,i)=>{const s=l.xo[i],n=t.buildings[i],o=this.getAccumulativeCost(n,s);return e+this.getPoints(o)}),0):l.Ne.reduce(((e,i)=>{const s=l.xo[i],n=t.buildings[i],o=this.getAccumulativeCost(n,s);return e+this.getPoints(o)}),0),e+i}),0);return e+n+t/2+s/2}getMilitaryPoints(){const e=this.planets.reduce(((e,t)=>e+this.getDefensePoints(t)),0),t=this.planetAndMoons.filter((e=>e.isMoon)).reduce(((e,t)=>{const i=this.getAccumulativeCost(t.buildings[r.A.sensorPhalanx],c.T),s=this.getAccumulativeCost(t.buildings[r.A.jumpGate],c.T),n=this.getPoints(i)+this.getPoints(s);return e+n}),0),i=v.v6.filter((e=>v.Hr.includes(e))),s=this.planetAndMoons.reduce(((e,t)=>{let i;return i=t.isMoon?v.Hf.filter((e=>v.Hr.includes(e))).reduce(((e,i)=>{const s=v.lp[i],n=(0,a.fB)(s.cost,t.ships[i]);return e+this.getPoints(n)}),0):v.oN.filter((e=>v.Hr.includes(e))).reduce(((e,i)=>{const s=v.lp[i],n=(0,a.fB)(s.cost,t.ships[i]);return e+this.getPoints(n)}),0),e+i}),0)+this.ownReturningFleets.reduce(((e,t)=>{const s=i.reduce(((e,i)=>{const s=t.ships[i],n=v.lp[i],o=(0,a.fB)(n.cost,s);return e+this.getPoints(o)}),0);return e+s}),0),n=v.v6.filter((e=>v.XZ.includes(e))),o=this.planetAndMoons.reduce(((e,t)=>{let i;return i=t.isMoon?v.Hf.filter((e=>v.XZ.includes(e))).reduce(((e,i)=>{const s=v.lp[i],n=(0,a.fB)(s.cost,t.ships[i]);return e+this.getPoints(n)}),0):v.oN.filter((e=>v.XZ.includes(e))).reduce(((e,i)=>{const s=v.lp[i],n=(0,a.fB)(s.cost,t.ships[i]);return e+this.getPoints(n)}),0),e+i}),0)+this.ownReturningFleets.reduce(((e,t)=>{const i=n.reduce(((e,i)=>{const s=t.ships[i],n=v.lp[i],o=(0,a.fB)(n.cost,s);return e+this.getPoints(o)}),0);return e+i}),0);return e+t/2+s+o/2}get planetPointDistributions(){return this.planets.map((e=>({planetId:e.id,buildings:this.getPlanetBuildingPoints(e),lifeformBuildingsActive:this.getOtherLifeformBuildingPoints(e,!0),lifeformBuildingsInactive:this.getOtherLifeformBuildingPoints(e,!1),lifeformTechnologiesActive:this.getLifeformTechnologyPoints(e,!0),lifeformTechnologiesInactive:this.getLifeformTechnologyPoints(e,!1),defense:this.getDefensePoints(e),ships:this.getPlanetShipPoints(e)})))}getLifeformTechnologyPoints(e,t){const i=m.Vs.filter((i=>e.activeLifeformTechnologies.includes(i)==t));let s={metal:0,crystal:0,deuterium:0,energy:0};return i.forEach((t=>{const i=p.dy[t];s=(0,a.aV)(s,this.getAccumulativeCost(e.lifeformTechnologies[t],i))}),0),this.getPoints(s)}get moonPointDistributions(){const e=Object.values(A.p.empire.planets).filter((e=>e.isMoon));return e.map((e=>({moonId:e.id,buildings:this.getMoonBuildingPoints(e),defense:this.getDefensePoints(e),ships:this.getMoonShipPoints(e)})))}get researchPoints(){const e=A.p.empire.research;let t={metal:0,crystal:0,deuterium:0,energy:0};return P.N.forEach((i=>{const s=P.i[i];t=(0,a.aV)(t,this.getAccumulativeCost(e[i],s))})),this.getPoints(t)}toNumber(e){return"boolean"===typeof e?e?1:0:e}getDefensePoints(e){let t={metal:0,crystal:0,deuterium:0,energy:0};return h.Q.forEach((i=>{const s=this.toNumber(e.defense[i]),n=h.V[i],o=(0,a.fB)(n.cost,s);t=(0,a.aV)(t,o)})),this.getPoints(t)}get ownReturningFleets(){const e=A.p.empire.fleets,t=this.planetAndMoons;return e.filter((e=>(e.isReturnFlight||e.mission==f.q.deployment)&&t.some((t=>(0,u.a)(t.coordinates,e.originCoordinates)))))}get fleetsShipPoints(){let e={metal:0,crystal:0,deuterium:0,energy:0};return this.ownReturningFleets.forEach((t=>{v.v6.forEach((i=>{const s=t.ships[i],n=v.lp[i],o=(0,a.fB)(n.cost,s);e=(0,a.aV)(e,o)}))})),this.getPoints(e)}getPlanetShipPoints(e){let t={metal:0,crystal:0,deuterium:0,energy:0};return v.oN.forEach((i=>{const s=e.ships[i],n=v.lp[i],o=(0,a.fB)(n.cost,s);t=(0,a.aV)(t,o)})),this.getPoints(t)}getMoonShipPoints(e){let t={metal:0,crystal:0,deuterium:0,energy:0};return v.Hf.forEach((i=>{const s=e.ships[i],n=v.lp[i],o=(0,a.fB)(n.cost,s);t=(0,a.aV)(t,o)})),this.getPoints(t)}getOtherLifeformBuildingPoints(e,t){const i=t?d.IU[e.activeLifeform]:d.YS.filter((t=>!d.IU[e.activeLifeform].includes(t))),s=g.yn.map((e=>e.type)),n=i.filter((e=>!s.includes(e)));let o={metal:0,crystal:0,deuterium:0,energy:0};return n.forEach((t=>{const i=g.ry[t];o=(0,a.aV)(o,this.getAccumulativeCost(e.lifeformBuildings[t],i))}),0),this.getPoints(o)}getAccumulativeCost(e,t){let i={metal:0,crystal:0,deuterium:0,energy:0};for(let s=1;s<=e;s++)i=(0,a.aV)(i,t.getCost(s));return i}getPlanetBuildingPoints(e){let t={metal:0,crystal:0,deuterium:0,energy:0};return l.Ne.forEach((i=>{const s=l.xo[i];t=(0,a.aV)(t,this.getAccumulativeCost(e.buildings[i],s))})),this.getPoints(t)}getMoonBuildingPoints(e){let t={metal:0,crystal:0,deuterium:0,energy:0};return l.RP.forEach((i=>{const s=l.xo[i];t=(0,a.aV)(t,this.getAccumulativeCost(e.buildings[i],s))})),this.getPoints(t)}getPoints(e){return(e.metal+e.crystal+e.deuterium)/1e3}};C=(0,o.gn)([(0,b.wA)({})],C);const L=C,T=L;var O=i(1001),I=(0,O.Z)(T,s,n,!1,null,null,null);const M=I.exports}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUdBLDZCQUNBLGdFQUNBLG1CQUNBLFlBRUEsd0NBQ0EsaUNBQ0Esb0NBSUEscUJBQ0EsNEJBQ0EsK0NBT0EsT0FMQSxpQkFDQSxlQUNBLGtEQUdBLGtCQUdBLFlBQ0EsMkJBQ0EsTUFHQSxFQUdBLG9CQUNBLCtDQVVBLE9BUkEsaUJBQ0Esb0NBQ0EsU0FFQSxxQkFDQSxtQkFHQSxrQkFHQSx5QkFDQSwwQkFDQSxzQkFDQSxxQkFFQSxrQkFDQSw0QkFDQSwwREFJQSx1QkFDQSwrQ0FZQSxPQVZBLHFDQUNBLGtCQUNBLG1CQUNBLFVBRUEscUJBQ0Esc0JBSUEsa0JBR0EsdUJBQ0EsK0NBV0EsT0FUQSxjQUNBLElBQ0EsbUJBQ0EsVUFFQSxxQkFDQSxtQkFHQSxrQkFHQSxxQkFDQSwrQ0FXQSxPQVRBLGNBQ0EsSUFDQSxtQkFDQSxVQUVBLHFCQUNBLG1CQUdBLGtCQUlBLG9DQUNBLFVBQ0EsdUJBQ0Esc0RBQ0Esd0JBRUEsZ0NBRUEsK0NBTUEsT0FMQSxlQUNBLGdCQUNBLG1FQUNBLEdBRUEsa0JBR0EseUJBQ0EsK0NBRUEscUJBQ0EsMkJBR0EsU0FHQSwyQkFDQSwrQ0FPQSxPQUxBLGtCQUNBLGdCQUNBLDREQUdBLGtCQUdBLHlCQUNBLCtDQU9BLE9BTEEsa0JBQ0EsZ0JBQ0EsNERBR0Esa0JBR0EsYUFDQSw0Q0FqakJBLGFBREEsYUFDQSxHLFVDekU2YyxJLGNDT3pjQyxHQUFZLE9BQ2QsRUFDQXBCLEVBQ0FtQixHQUNBLEVBQ0EsS0FDQSxLQUNBLE1BSUYsUUFBZUMsRUFBaUIiLCJzb3VyY2VzIjpbIm9nYW1lLXRyYWNrZXI6Ly8vLi9zcmMvc2hhcmVkL21vZGVscy9vZ2FtZS9jb21tb24vQ29vcmRpbmF0ZXMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3ZpZXdzL3N0YXRzL3ZpZXdzL2VtcGlyZS9Qb2ludC1EaXN0cmlidXRpb24udnVlPzE4NTAiLCJ3ZWJwYWNrOi8vL3NyYy92aWV3cy9zdGF0cy92aWV3cy9lbXBpcmUvUG9pbnQtRGlzdHJpYnV0aW9uLnZ1ZT9kMDNjIiwid2VicGFjazovLy8uL3NyYy92aWV3cy9zdGF0cy92aWV3cy9lbXBpcmUvUG9pbnQtRGlzdHJpYnV0aW9uLnZ1ZT9lYjIwIiwid2VicGFjazovLy8uL3NyYy92aWV3cy9zdGF0cy92aWV3cy9lbXBpcmUvUG9pbnQtRGlzdHJpYnV0aW9uLnZ1ZT8zNmY3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBsYW5ldFR5cGUgfSBmcm9tICcuL1BsYW5ldFR5cGUnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBDb29yZGluYXRlcyB7XHJcbiAgICBnYWxheHk6IG51bWJlcjtcclxuICAgIHN5c3RlbTogbnVtYmVyO1xyXG4gICAgcG9zaXRpb246IG51bWJlcjtcclxuICAgIHR5cGU6IFBsYW5ldFR5cGU7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlQ29vcmRpbmF0ZXMoYTogQ29vcmRpbmF0ZXMsIGI6IENvb3JkaW5hdGVzKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IGtleXM6IChrZXlvZiBDb29yZGluYXRlcylbXSA9IFtcclxuICAgICAgICAnZ2FsYXh5JyxcclxuICAgICAgICAnc3lzdGVtJyxcclxuICAgICAgICAncG9zaXRpb24nLFxyXG4gICAgICAgICd0eXBlJyxcclxuICAgIF07XHJcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7XHJcbiAgICAgICAgY29uc3QgZGlmZiA9IGFba2V5XSAtIGJba2V5XTtcclxuICAgICAgICBpZiAoZGlmZiAhPSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkaWZmO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiAwO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY29vcmRpbmF0ZXNFcXVhbChhOiBDb29yZGluYXRlcywgYjogQ29vcmRpbmF0ZXMpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBjb21wYXJlQ29vcmRpbmF0ZXMoYSwgYikgPT0gMDtcclxufSIsInZhciByZW5kZXIgPSBmdW5jdGlvbiAoKSB7dmFyIF92bT10aGlzO3ZhciBfaD1fdm0uJGNyZWF0ZUVsZW1lbnQ7dmFyIF9jPV92bS5fc2VsZi5fY3x8X2g7cmV0dXJuIF9jKCdkaXYnLHtzdGF0aWNDbGFzczpcInBvaW50LWRpc3RyaWJ1dGlvblwifSxbX2MoJ2dyaWQtdGFibGUnLHthdHRyczp7XCJjb2x1bW5zXCI6X3ZtLmNvbHVtbnMsXCJpdGVtc1wiOl92bS5pdGVtcyxcImZvb3Rlckl0ZW1zXCI6X3ZtLmZvb3Rlckl0ZW1zLFwiaW5saW5lXCI6XCJcIn0sc2NvcGVkU2xvdHM6X3ZtLl91KFt7a2V5OlwiY2VsbC1wb2ludHNcIixmbjpmdW5jdGlvbihyZWYpe1xudmFyIHZhbHVlID0gcmVmLnZhbHVlO1xucmV0dXJuIFtfYygnZGVjaW1hbC1udW1iZXInLHthdHRyczp7XCJ2YWx1ZVwiOnZhbHVlfX0pXX19LHtrZXk6XCJmb290ZXItcG9pbnRzXCIsZm46ZnVuY3Rpb24ocmVmKXtcbnZhciB2YWx1ZSA9IHJlZi52YWx1ZTtcbnJldHVybiBbX2MoJ2RlY2ltYWwtbnVtYmVyJyx7YXR0cnM6e1widmFsdWVcIjp2YWx1ZX19KV19fV0pfSksX2MoJ2dyaWQtdGFibGUnLHthdHRyczp7XCJjb2x1bW5zXCI6X3ZtLmNvbHVtbnMsXCJpdGVtc1wiOl92bS5oaWdoc2NvcmVJdGVtcyxcImZvb3Rlckl0ZW1zXCI6X3ZtLmhpZ2hzY29yZUZvb3Rlckl0ZW1zLFwiaW5saW5lXCI6XCJcIn0sc2NvcGVkU2xvdHM6X3ZtLl91KFt7a2V5OlwiY2VsbC1wb2ludHNcIixmbjpmdW5jdGlvbihyZWYpe1xudmFyIHZhbHVlID0gcmVmLnZhbHVlO1xucmV0dXJuIFtfYygnZGVjaW1hbC1udW1iZXInLHthdHRyczp7XCJ2YWx1ZVwiOnZhbHVlfX0pXX19LHtrZXk6XCJmb290ZXItcG9pbnRzXCIsZm46ZnVuY3Rpb24ocmVmKXtcbnZhciB2YWx1ZSA9IHJlZi52YWx1ZTtcbnJldHVybiBbX2MoJ2RlY2ltYWwtbnVtYmVyJyx7YXR0cnM6e1widmFsdWVcIjp2YWx1ZX19KV19fV0pfSldLDEpfVxudmFyIHN0YXRpY1JlbmRlckZucyA9IFtdXG5cbmV4cG9ydCB7IHJlbmRlciwgc3RhdGljUmVuZGVyRm5zIH0iLCI8dGVtcGxhdGU+XHJcbiAgICA8ZGl2IGNsYXNzPVwicG9pbnQtZGlzdHJpYnV0aW9uXCI+XHJcbiAgICAgICAgPGdyaWQtdGFibGUgOmNvbHVtbnM9XCJjb2x1bW5zXCIgOml0ZW1zPVwiaXRlbXNcIiA6Zm9vdGVySXRlbXM9XCJmb290ZXJJdGVtc1wiIGlubGluZT5cclxuICAgICAgICAgICAgPHRlbXBsYXRlICNjZWxsLXBvaW50cz1cInsgdmFsdWUgfVwiPlxyXG4gICAgICAgICAgICAgICAgPGRlY2ltYWwtbnVtYmVyIDp2YWx1ZT1cInZhbHVlXCIgLz5cclxuICAgICAgICAgICAgPC90ZW1wbGF0ZT5cclxuICAgICAgICAgICAgPHRlbXBsYXRlICNmb290ZXItcG9pbnRzPVwieyB2YWx1ZSB9XCI+XHJcbiAgICAgICAgICAgICAgICA8ZGVjaW1hbC1udW1iZXIgOnZhbHVlPVwidmFsdWVcIiAvPlxyXG4gICAgICAgICAgICA8L3RlbXBsYXRlPlxyXG4gICAgICAgIDwvZ3JpZC10YWJsZT5cclxuICAgICAgICA8Z3JpZC10YWJsZSA6Y29sdW1ucz1cImNvbHVtbnNcIiA6aXRlbXM9XCJoaWdoc2NvcmVJdGVtc1wiIDpmb290ZXJJdGVtcz1cImhpZ2hzY29yZUZvb3Rlckl0ZW1zXCIgaW5saW5lPlxyXG4gICAgICAgICAgICA8dGVtcGxhdGUgI2NlbGwtcG9pbnRzPVwieyB2YWx1ZSB9XCI+XHJcbiAgICAgICAgICAgICAgICA8ZGVjaW1hbC1udW1iZXIgOnZhbHVlPVwidmFsdWVcIiAvPlxyXG4gICAgICAgICAgICA8L3RlbXBsYXRlPlxyXG4gICAgICAgICAgICA8dGVtcGxhdGUgI2Zvb3Rlci1wb2ludHM9XCJ7IHZhbHVlIH1cIj5cclxuICAgICAgICAgICAgICAgIDxkZWNpbWFsLW51bWJlciA6dmFsdWU9XCJ2YWx1ZVwiIC8+XHJcbiAgICAgICAgICAgIDwvdGVtcGxhdGU+XHJcbiAgICAgICAgPC9ncmlkLXRhYmxlPlxyXG4gICAgPC9kaXY+XHJcbjwvdGVtcGxhdGU+XHJcblxyXG48c2NyaXB0IGxhbmc9XCJ0c1wiPlxyXG4gICAgaW1wb3J0IHsgTW9vbkRhdGEgfSBmcm9tICdAL3NoYXJlZC9tb2RlbHMvZW1waXJlL01vb25EYXRhJztcclxuICAgIGltcG9ydCB7IFBsYW5ldERhdGEgfSBmcm9tICdAL3NoYXJlZC9tb2RlbHMvZW1waXJlL1BsYW5ldERhdGEnO1xyXG4gICAgaW1wb3J0IHsgUGxhbmV0RGF0YUJhc2UgfSBmcm9tICdAL3NoYXJlZC9tb2RlbHMvZW1waXJlL1BsYW5ldERhdGFCYXNlJztcclxuICAgIGltcG9ydCB7IEJ1aWxkaW5nVHlwZSB9IGZyb20gJ0Avc2hhcmVkL21vZGVscy9vZ2FtZS9idWlsZGluZ3MvQnVpbGRpbmdUeXBlJztcclxuICAgIGltcG9ydCB7IE1vb25CdWlsZGluZ1R5cGVzIH0gZnJvbSAnQC9zaGFyZWQvbW9kZWxzL29nYW1lL2J1aWxkaW5ncy9CdWlsZGluZ1R5cGVzJztcclxuICAgIGltcG9ydCB7IEJ1aWxkaW5nc0J5VHlwZSwgUGxhbmV0QnVpbGRpbmdUeXBlcyB9IGZyb20gJ0Avc2hhcmVkL21vZGVscy9vZ2FtZS9idWlsZGluZ3MvQnVpbGRpbmdUeXBlcyc7XHJcbiAgICBpbXBvcnQgeyBTZW5zb3JQaGFsYW54IH0gZnJvbSAnQC9zaGFyZWQvbW9kZWxzL29nYW1lL2J1aWxkaW5ncy9TZW5zb3JQaGFsYW54JztcclxuICAgIGltcG9ydCB7IGNvb3JkaW5hdGVzRXF1YWwgfSBmcm9tICdAL3NoYXJlZC9tb2RlbHMvb2dhbWUvY29tbW9uL0Nvb3JkaW5hdGVzJztcclxuICAgIGltcG9ydCB7IGFkZENvc3QsIENvc3QsIG11bHRpcGx5Q29zdCB9IGZyb20gJ0Avc2hhcmVkL21vZGVscy9vZ2FtZS9jb21tb24vQ29zdCc7XHJcbiAgICBpbXBvcnQgeyBEZWZlbnNlQnlUeXBlcywgRGVmZW5zZVR5cGVzIH0gZnJvbSAnQC9zaGFyZWQvbW9kZWxzL29nYW1lL2RlZmVuc2VzL0RlZmVuc2VUeXBlcyc7XHJcbmltcG9ydCB7IEZsZWV0TWlzc2lvblR5cGUgfSBmcm9tICdAL3NoYXJlZC9tb2RlbHMvb2dhbWUvZmxlZXRzL0ZsZWV0TWlzc2lvblR5cGUnO1xyXG4gICAgaW1wb3J0IHsgRmxlZXQgfSBmcm9tICdAL3NoYXJlZC9tb2RlbHMvb2dhbWUvZmxlZXRzL3R5cGVzJztcclxuICAgIGltcG9ydCB7IExpZmVmb3JtQnVpbGRpbmdzQnlUeXBlLCBSZXNvdXJjZVByb2R1Y3Rpb25Cb251c0xpZmVmb3JtQnVpbGRpbmdzIH0gZnJvbSAnQC9zaGFyZWQvbW9kZWxzL29nYW1lL2xpZmVmb3Jtcy9idWlsZGluZ3MvTGlmZWZvcm1CdWlsZGluZ3MnO1xyXG4gICAgaW1wb3J0IHsgTGlmZWZvcm1CdWlsZGluZ1R5cGVzLCBMaWZlZm9ybUJ1aWxkaW5nVHlwZXNCeUxpZmVmb3JtIH0gZnJvbSAnQC9zaGFyZWQvbW9kZWxzL29nYW1lL2xpZmVmb3Jtcy9MaWZlZm9ybUJ1aWxkaW5nVHlwZSc7XHJcbiAgICBpbXBvcnQgeyBMaWZlZm9ybVRlY2hub2xvZ3lUeXBlcyB9IGZyb20gJ0Avc2hhcmVkL21vZGVscy9vZ2FtZS9saWZlZm9ybXMvTGlmZWZvcm1UZWNobm9sb2d5VHlwZSc7XHJcbiAgICBpbXBvcnQgeyBMaWZlZm9ybVRlY2hub2xvZ2llc0J5VHlwZSB9IGZyb20gJ0Avc2hhcmVkL21vZGVscy9vZ2FtZS9saWZlZm9ybXMvdGVjaG5vbG9naWVzL0xpZmVmb3JtVGVjaG5vbG9naWVzJztcclxuICAgIGltcG9ydCB7IFJlc2VhcmNoQnlUeXBlcywgUmVzZWFyY2hUeXBlcyB9IGZyb20gJ0Avc2hhcmVkL21vZGVscy9vZ2FtZS9yZXNlYXJjaC9SZXNlYXJjaFR5cGVzJztcclxuICAgIGltcG9ydCB7IFNoaXBUeXBlIH0gZnJvbSAnQC9zaGFyZWQvbW9kZWxzL29nYW1lL3NoaXBzL1NoaXBUeXBlJztcclxuICAgIGltcG9ydCB7IENpdmlsU2hpcFR5cGVzLCBNaWxpdGFyeVNoaXBUeXBlcywgTW9vblNoaXBUeXBlcywgTm9uU3RhdGlvbmFyeVNoaXBUeXBlcywgUGxhbmV0U2hpcFR5cGVzLCBTaGlwQnlUeXBlcyB9IGZyb20gJ0Avc2hhcmVkL21vZGVscy9vZ2FtZS9zaGlwcy9TaGlwVHlwZXMnO1xyXG4gICAgaW1wb3J0IHsgQ29tcG9uZW50LCBWdWUgfSBmcm9tICd2dWUtcHJvcGVydHktZGVjb3JhdG9yJztcclxuICAgIGltcG9ydCB7IEdyaWRUYWJsZUNvbHVtbiB9IGZyb20gJy4uLy4uL2NvbXBvbmVudHMvY29tbW9uL0dyaWRUYWJsZS52dWUnO1xyXG4gICAgaW1wb3J0IHsgRW1waXJlRGF0YU1vZHVsZSB9IGZyb20gJy4uLy4uL2RhdGEvRW1waXJlRGF0YU1vZHVsZSc7XHJcbiAgICBpbXBvcnQgeyBMaWZlZm9ybURpc2NvdmVyeURhdGFNb2R1bGUgfSBmcm9tICcuLi8uLi9kYXRhL0xpZmVmb3JtRGlzY292ZXJ5RGF0YU1vZHVsZSc7XHJcbiAgICBpbXBvcnQgeyBTZXJ2ZXJTZXR0aW5nc0RhdGFNb2R1bGUgfSBmcm9tICcuLi8uLi9kYXRhL1NlcnZlclNldHRpbmdzRGF0YU1vZHVsZSc7XHJcblxyXG4gICAgaW50ZXJmYWNlIFBsYW5ldFBvaW50RGlzdHJpYnV0aW9uSXRlbSB7XHJcbiAgICAgICAgcGxhbmV0SWQ6IG51bWJlcjtcclxuXHJcbiAgICAgICAgYnVpbGRpbmdzOiBudW1iZXI7XHJcbiAgICAgICAgbGlmZWZvcm1CdWlsZGluZ3NBY3RpdmU6IG51bWJlcjtcclxuICAgICAgICBsaWZlZm9ybUJ1aWxkaW5nc0luYWN0aXZlOiBudW1iZXI7XHJcbiAgICAgICAgbGlmZWZvcm1UZWNobm9sb2dpZXNBY3RpdmU6IG51bWJlcjtcclxuICAgICAgICBsaWZlZm9ybVRlY2hub2xvZ2llc0luYWN0aXZlOiBudW1iZXI7XHJcblxyXG4gICAgICAgIGRlZmVuc2U6IG51bWJlcjtcclxuICAgICAgICBzaGlwczogbnVtYmVyO1xyXG4gICAgfVxyXG5cclxuICAgIGludGVyZmFjZSBNb29uUG9pbnREaXN0cmlidXRpb25JdGVtIHtcclxuICAgICAgICBtb29uSWQ6IG51bWJlcjtcclxuICAgICAgICBidWlsZGluZ3M6IG51bWJlcjtcclxuICAgICAgICBkZWZlbnNlOiBudW1iZXI7XHJcbiAgICAgICAgc2hpcHM6IG51bWJlcjtcclxuICAgIH1cclxuXHJcbiAgICBpbnRlcmZhY2UgUG9pbnREaXN0cmlidXRpb25Sb3cge1xyXG4gICAgICAgIGxhYmVsOiBzdHJpbmc7XHJcbiAgICAgICAgcG9pbnRzOiBudW1iZXI7XHJcbiAgICB9XHJcblxyXG4gICAgQENvbXBvbmVudCh7fSlcclxuICAgIGV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvaW50RGlzdHJpYnV0aW9uIGV4dGVuZHMgVnVlIHtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBnZXQgY29sdW1ucygpOiBHcmlkVGFibGVDb2x1bW48a2V5b2YgUG9pbnREaXN0cmlidXRpb25Sb3c+W10ge1xyXG4gICAgICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgICAgICAgeyBrZXk6ICdsYWJlbCcsIGxhYmVsOiAnTE9DQTogQ2F0ZWdvcnknIH0sXHJcbiAgICAgICAgICAgICAgICB7IGtleTogJ3BvaW50cycsIGxhYmVsOiAnTE9DQTogUG9pbnRzJyB9LFxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBnZXQgcG9pbnREaXN0cmlidXRpb24oKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc2VhcmNoUG9pbnRzID0gdGhpcy5yZXNlYXJjaFBvaW50cztcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHRvdGFsID0ge1xyXG4gICAgICAgICAgICAgICAgcmVzZWFyY2g6IHJlc2VhcmNoUG9pbnRzLFxyXG5cclxuICAgICAgICAgICAgICAgIHBsYW5ldEJ1aWxkaW5nczogMCxcclxuICAgICAgICAgICAgICAgIG1vb25CdWlsZGluZ3M6IDAsXHJcblxyXG4gICAgICAgICAgICAgICAgbGlmZWZvcm1CdWlsZGluZ3NBY3RpdmU6IDAsXHJcbiAgICAgICAgICAgICAgICBsaWZlZm9ybUJ1aWxkaW5nc0luYWN0aXZlOiAwLFxyXG4gICAgICAgICAgICAgICAgbGlmZWZvcm1UZWNobm9sb2dpZXNBY3RpdmU6IDAsXHJcbiAgICAgICAgICAgICAgICBsaWZlZm9ybVRlY2hub2xvZ2llc0luYWN0aXZlOiAwLFxyXG5cclxuICAgICAgICAgICAgICAgIGRlZmVuc2U6IDAsXHJcbiAgICAgICAgICAgICAgICBzaGlwczogMCxcclxuICAgICAgICAgICAgICAgIHNoaXBzSW5UcmFuc2l0OiB0aGlzLmZsZWV0c1NoaXBQb2ludHMsXHJcblxyXG4gICAgICAgICAgICAgICAgdG90YWw6IHJlc2VhcmNoUG9pbnRzLFxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5wbGFuZXRQb2ludERpc3RyaWJ1dGlvbnMuZm9yRWFjaChwbGFuZXQgPT4ge1xyXG4gICAgICAgICAgICAgICAgdG90YWwucGxhbmV0QnVpbGRpbmdzICs9IHBsYW5ldC5idWlsZGluZ3M7XHJcblxyXG4gICAgICAgICAgICAgICAgdG90YWwubGlmZWZvcm1CdWlsZGluZ3NBY3RpdmUgKz0gcGxhbmV0LmxpZmVmb3JtQnVpbGRpbmdzQWN0aXZlO1xyXG4gICAgICAgICAgICAgICAgdG90YWwubGlmZWZvcm1CdWlsZGluZ3NJbmFjdGl2ZSArPSBwbGFuZXQubGlmZWZvcm1CdWlsZGluZ3NJbmFjdGl2ZTtcclxuICAgICAgICAgICAgICAgIHRvdGFsLmxpZmVmb3JtVGVjaG5vbG9naWVzQWN0aXZlICs9IHBsYW5ldC5saWZlZm9ybVRlY2hub2xvZ2llc0FjdGl2ZTtcclxuICAgICAgICAgICAgICAgIHRvdGFsLmxpZmVmb3JtVGVjaG5vbG9naWVzSW5hY3RpdmUgKz0gcGxhbmV0LmxpZmVmb3JtVGVjaG5vbG9naWVzSW5hY3RpdmU7XHJcblxyXG4gICAgICAgICAgICAgICAgdG90YWwuZGVmZW5zZSArPSBwbGFuZXQuZGVmZW5zZTtcclxuICAgICAgICAgICAgICAgIHRvdGFsLnNoaXBzICs9IHBsYW5ldC5zaGlwcztcclxuXHJcbiAgICAgICAgICAgICAgICAoT2JqZWN0LmtleXMocGxhbmV0KSBhcyAoa2V5b2YgUGxhbmV0UG9pbnREaXN0cmlidXRpb25JdGVtKVtdKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSAhPSAncGxhbmV0SWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsLnRvdGFsICs9IHBsYW5ldFtrZXldO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMubW9vblBvaW50RGlzdHJpYnV0aW9ucy5mb3JFYWNoKG1vb24gPT4ge1xyXG4gICAgICAgICAgICAgICAgdG90YWwubW9vbkJ1aWxkaW5ncyArPSBtb29uLmJ1aWxkaW5ncztcclxuXHJcbiAgICAgICAgICAgICAgICB0b3RhbC5kZWZlbnNlICs9IG1vb24uZGVmZW5zZTtcclxuICAgICAgICAgICAgICAgIHRvdGFsLnNoaXBzICs9IG1vb24uc2hpcHM7XHJcblxyXG4gICAgICAgICAgICAgICAgKE9iamVjdC5rZXlzKG1vb24pIGFzIChrZXlvZiBNb29uUG9pbnREaXN0cmlidXRpb25JdGVtKVtdKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSAhPSAnbW9vbklkJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbC50b3RhbCArPSBtb29uW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRvdGFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBnZXQgaGlnaHNjb3JlUG9pbnRzKCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZWNvbm9teTogdGhpcy5nZXRFY29ub215UG9pbnRzKCksXHJcbiAgICAgICAgICAgICAgICByZXNlYXJjaDogdGhpcy5yZXNlYXJjaFBvaW50cyxcclxuICAgICAgICAgICAgICAgIG1pbGl0YXJ5OiB0aGlzLmdldE1pbGl0YXJ5UG9pbnRzKCksXHJcbiAgICAgICAgICAgICAgICBsaWZlZm9ybXM6IHRoaXMuZ2V0TGlmZWZvcm1Qb2ludHMoKSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgZ2V0IGhpZ2hzY29yZUl0ZW1zKCk6IFBvaW50RGlzdHJpYnV0aW9uUm93W10ge1xyXG4gICAgICAgICAgICBjb25zdCB7IGVjb25vbXksIHJlc2VhcmNoLCBtaWxpdGFyeSwgbGlmZWZvcm1zIH0gPSB0aGlzLmhpZ2hzY29yZVBvaW50cztcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdDogUG9pbnREaXN0cmlidXRpb25Sb3dbXSA9IFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0xPQ0E6IEVjb25vbXknLFxyXG4gICAgICAgICAgICAgICAgICAgIHBvaW50czogZWNvbm9teSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdMT0NBOiBSZXNlYXJjaCcsXHJcbiAgICAgICAgICAgICAgICAgICAgcG9pbnRzOiByZXNlYXJjaCxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdMT0NBOiBNaWxpdGFyeScsXHJcbiAgICAgICAgICAgICAgICAgICAgcG9pbnRzOiBtaWxpdGFyeSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIF07XHJcblxyXG4gICAgICAgICAgICBpZiAoU2VydmVyU2V0dGluZ3NEYXRhTW9kdWxlLnNlcnZlclNldHRpbmdzLmxpZmVmb3Jtcy5lbmFibGVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdMT0NBOiBMaWZlZm9ybXMnLFxyXG4gICAgICAgICAgICAgICAgICAgIHBvaW50czogbGlmZWZvcm1zLFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBnZXQgaGlnaHNjb3JlRm9vdGVySXRlbXMoKTogUG9pbnREaXN0cmlidXRpb25Sb3dbXSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRvdGFsID0gT2JqZWN0LnZhbHVlcyh0aGlzLmhpZ2hzY29yZVBvaW50cykucmVkdWNlKCh0b3RhbCwgcG9pbnRzKSA9PiB0b3RhbCArIHBvaW50cywgMCk7IC8vVE9ETzogZG9udCBpbmNsdWRlIGRlZmVuc2VzIHR3aWNlXHJcblxyXG4gICAgICAgICAgICByZXR1cm4gW3tcclxuICAgICAgICAgICAgICAgIGxhYmVsOiAnTE9DQTogVG90YWwgUG9pbnRzJyxcclxuICAgICAgICAgICAgICAgIHBvaW50czogdG90YWwsXHJcbiAgICAgICAgICAgIH1dO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBnZXQgaXRlbXMoKTogUG9pbnREaXN0cmlidXRpb25Sb3dbXSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRvdGFsID0gdGhpcy5wb2ludERpc3RyaWJ1dGlvbjtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdDogUG9pbnREaXN0cmlidXRpb25Sb3dbXSA9IFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0xPQ0E6IFBsYW5ldCBCdWlsZGluZ3MnLFxyXG4gICAgICAgICAgICAgICAgICAgIHBvaW50czogdG90YWwucGxhbmV0QnVpbGRpbmdzLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgXTtcclxuXHJcbiAgICAgICAgICAgIGlmIChTZXJ2ZXJTZXR0aW5nc0RhdGFNb2R1bGUuc2VydmVyU2V0dGluZ3MubGlmZWZvcm1zLmVuYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdMT0NBOiBMaWZlZm9ybSBCdWlsZGluZ3MgKGFjdGl2ZSknLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludHM6IHRvdGFsLmxpZmVmb3JtQnVpbGRpbmdzQWN0aXZlLFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0xPQ0E6IExpZmVmb3JtIEJ1aWxkaW5ncyAoaW5hY3RpdmUpJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzOiB0b3RhbC5saWZlZm9ybUJ1aWxkaW5nc0luYWN0aXZlLFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0xPQ0E6IExpZmVmb3JtIFRlY2hub2xvZ2llc3MgKGFjdGl2ZSknLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludHM6IHRvdGFsLmxpZmVmb3JtVGVjaG5vbG9naWVzQWN0aXZlLFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0xPQ0E6IExpZmVmb3JtIFRlY2hub2xvZ2llc3MgKGluYWN0aXZlKScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50czogdG90YWwubGlmZWZvcm1UZWNobm9sb2dpZXNJbmFjdGl2ZSxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnTE9DQTogTW9vbiBCdWlsZGluZ3MnLFxyXG4gICAgICAgICAgICAgICAgICAgIHBvaW50czogdG90YWwubW9vbkJ1aWxkaW5ncyxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdMT0NBOiBSZXNlYXJjaCcsXHJcbiAgICAgICAgICAgICAgICAgICAgcG9pbnRzOiB0b3RhbC5yZXNlYXJjaCxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdMT0NBOiBEZWZlbnNlJyxcclxuICAgICAgICAgICAgICAgICAgICBwb2ludHM6IHRvdGFsLmRlZmVuc2UsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnTE9DQTogU2hpcHMnLFxyXG4gICAgICAgICAgICAgICAgICAgIHBvaW50czogdG90YWwuc2hpcHMsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnTE9DQTogU2hpcHMgaW4gdHJhbnNpdCcsXHJcbiAgICAgICAgICAgICAgICAgICAgcG9pbnRzOiB0b3RhbC5zaGlwc0luVHJhbnNpdCxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBnZXQgZm9vdGVySXRlbXMoKTogUG9pbnREaXN0cmlidXRpb25Sb3dbXSB7XHJcbiAgICAgICAgICAgIHJldHVybiBbe1xyXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdMT0NBOiBBY3R1YWwgVG90YWwgUG9pbnRzJyxcclxuICAgICAgICAgICAgICAgIHBvaW50czogdGhpcy5wb2ludERpc3RyaWJ1dGlvbi50b3RhbCxcclxuICAgICAgICAgICAgfV07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGdldCBwbGFuZXRzKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wbGFuZXRBbmRNb29ucy5maWx0ZXIocCA9PiAhcC5pc01vb24pIGFzIFBsYW5ldERhdGFbXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgZ2V0IHBsYW5ldEFuZE1vb25zKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhFbXBpcmVEYXRhTW9kdWxlLmVtcGlyZS5wbGFuZXRzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgZ2V0TGlmZWZvcm1Qb2ludHMoKTogbnVtYmVyIHtcclxuICAgICAgICAgICAgY29uc3QgYnVpbGRpbmdQb2ludHMgPSB0aGlzLnBsYW5ldHMucmVkdWNlKCh0b3RhbCwgcGxhbmV0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwb2ludHMgPSBMaWZlZm9ybUJ1aWxkaW5nVHlwZXMucmVkdWNlKCh0b3RhbCwgYnVpbGRpbmdUeXBlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGZCdWlsZGluZyA9IExpZmVmb3JtQnVpbGRpbmdzQnlUeXBlW2J1aWxkaW5nVHlwZV07XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29zdCA9IHRoaXMuZ2V0QWNjdW11bGF0aXZlQ29zdChwbGFuZXQubGlmZWZvcm1CdWlsZGluZ3NbYnVpbGRpbmdUeXBlXSwgbGZCdWlsZGluZyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbCArIHRoaXMuZ2V0UG9pbnRzKGNvc3QpO1xyXG4gICAgICAgICAgICAgICAgfSwgMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRvdGFsICsgcG9pbnRzO1xyXG4gICAgICAgICAgICB9LCAwKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHRlY2hub2xvZ3lQb2ludHMgPSB0aGlzLnBsYW5ldHMucmVkdWNlKCh0b3RhbCwgcGxhbmV0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwb2ludHMgPSBMaWZlZm9ybVRlY2hub2xvZ3lUeXBlcy5yZWR1Y2UoKHRvdGFsLCB0ZWNobm9sb2d5VHlwZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxmVGVjaCA9IExpZmVmb3JtVGVjaG5vbG9naWVzQnlUeXBlW3RlY2hub2xvZ3lUeXBlXTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3N0ID0gdGhpcy5nZXRBY2N1bXVsYXRpdmVDb3N0KHBsYW5ldC5saWZlZm9ybVRlY2hub2xvZ2llc1t0ZWNobm9sb2d5VHlwZV0sIGxmVGVjaCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbCArIHRoaXMuZ2V0UG9pbnRzKGNvc3QpO1xyXG4gICAgICAgICAgICAgICAgfSwgMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRvdGFsICsgcG9pbnRzO1xyXG4gICAgICAgICAgICB9LCAwKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGxpZmVmb3JtRGlzY292ZXJpZXMgPSBPYmplY3QudmFsdWVzKExpZmVmb3JtRGlzY292ZXJ5RGF0YU1vZHVsZS5saWZlZm9ybXMpLnJlZHVjZSgodG90YWwsIGluZm8pID0+IHRvdGFsICsgaW5mby5kaXNjb3Zlcmllc0NvdW50LCAwKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBidWlsZGluZ1BvaW50cyArIHRlY2hub2xvZ3lQb2ludHMgKyBsaWZlZm9ybURpc2NvdmVyaWVzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBnZXRFY29ub215UG9pbnRzKCk6IG51bWJlciB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRlZmVuc2UgPSB0aGlzLnBsYW5ldHMucmVkdWNlKCh0b3RhbCwgcGxhbmV0KSA9PiB0b3RhbCArIHRoaXMuZ2V0RGVmZW5zZVBvaW50cyhwbGFuZXQpLCAwKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHBoYWxhbnhlc0FuZEp1bXBHYXRlcyA9ICh0aGlzLnBsYW5ldEFuZE1vb25zLmZpbHRlcihwID0+IHAuaXNNb29uKSBhcyBNb29uRGF0YVtdKVxyXG4gICAgICAgICAgICAgICAgLnJlZHVjZSgodG90YWwsIG1vb24pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwaGFsYW54ID0gdGhpcy5nZXRBY2N1bXVsYXRpdmVDb3N0KG1vb24uYnVpbGRpbmdzW0J1aWxkaW5nVHlwZS5zZW5zb3JQaGFsYW54XSwgU2Vuc29yUGhhbGFueCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QganVtcEdhdGUgPSB0aGlzLmdldEFjY3VtdWxhdGl2ZUNvc3QobW9vbi5idWlsZGluZ3NbQnVpbGRpbmdUeXBlLmp1bXBHYXRlXSwgU2Vuc29yUGhhbGFueCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvaW50cyA9IHRoaXMuZ2V0UG9pbnRzKHBoYWxhbngpICsgdGhpcy5nZXRQb2ludHMoanVtcEdhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbCArIHBvaW50cztcclxuICAgICAgICAgICAgICAgIH0sIDApO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgY2l2aWxTaGlwVHlwZXMgPSBOb25TdGF0aW9uYXJ5U2hpcFR5cGVzLmZpbHRlcihzaGlwVHlwZSA9PiAoQ2l2aWxTaGlwVHlwZXMgYXMgU2hpcFR5cGVbXSkuaW5jbHVkZXMoc2hpcFR5cGUpKTtcclxuICAgICAgICAgICAgY29uc3QgY2l2aWxTaGlwcyA9IHRoaXMucGxhbmV0QW5kTW9vbnMucmVkdWNlKCh0b3RhbCwgcGxhbmV0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcG9pbnRzOiBudW1iZXI7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHBsYW5ldC5pc01vb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSBNb29uU2hpcFR5cGVzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoc2hpcCA9PiAoQ2l2aWxTaGlwVHlwZXMgYXMgU2hpcFR5cGVbXSkuaW5jbHVkZXMoc2hpcCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZWR1Y2UoKHRvdGFsLCBzaGlwVHlwZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2hpcCA9IFNoaXBCeVR5cGVzW3NoaXBUeXBlXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvc3QgPSBtdWx0aXBseUNvc3Qoc2hpcC5jb3N0LCBwbGFuZXQuc2hpcHNbc2hpcFR5cGVdKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG90YWwgKyB0aGlzLmdldFBvaW50cyhjb3N0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSBQbGFuZXRTaGlwVHlwZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihzaGlwID0+IChDaXZpbFNoaXBUeXBlcyBhcyBTaGlwVHlwZVtdKS5pbmNsdWRlcyhzaGlwKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlZHVjZSgodG90YWwsIHNoaXBUeXBlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzaGlwID0gU2hpcEJ5VHlwZXNbc2hpcFR5cGVdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29zdCA9IG11bHRpcGx5Q29zdChzaGlwLmNvc3QsIHBsYW5ldC5zaGlwc1tzaGlwVHlwZV0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbCArIHRoaXMuZ2V0UG9pbnRzKGNvc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdG90YWwgKyBwb2ludHM7XHJcbiAgICAgICAgICAgIH0sIDApICsgdGhpcy5vd25SZXR1cm5pbmdGbGVldHMucmVkdWNlKCh0b3RhbCwgZmxlZXQpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBvaW50cyA9IGNpdmlsU2hpcFR5cGVzLnJlZHVjZSgodG90YWwsIHNoaXBUeXBlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY291bnQgPSBmbGVldC5zaGlwc1tzaGlwVHlwZV07XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2hpcCA9IFNoaXBCeVR5cGVzW3NoaXBUeXBlXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29zdCA9IG11bHRpcGx5Q29zdChzaGlwLmNvc3QsIGNvdW50KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG90YWwgKyB0aGlzLmdldFBvaW50cyhjb3N0KTtcclxuICAgICAgICAgICAgICAgIH0sIDApO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbCArIHBvaW50cztcclxuICAgICAgICAgICAgfSwgMCk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBidWlsZGluZ3MgPSB0aGlzLnBsYW5ldEFuZE1vb25zXHJcbiAgICAgICAgICAgICAgICAucmVkdWNlKCh0b3RhbCwgcGxhbmV0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHBvaW50czogbnVtYmVyO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocGxhbmV0LmlzTW9vbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSBNb29uQnVpbGRpbmdUeXBlcy5yZWR1Y2UoKHRvdGFsLCB0eXBlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBidWlsZGluZyA9IEJ1aWxkaW5nc0J5VHlwZVt0eXBlXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxldmVsID0gcGxhbmV0LmJ1aWxkaW5nc1t0eXBlXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvc3QgPSB0aGlzLmdldEFjY3VtdWxhdGl2ZUNvc3QobGV2ZWwsIGJ1aWxkaW5nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG90YWwgKyB0aGlzLmdldFBvaW50cyhjb3N0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSBQbGFuZXRCdWlsZGluZ1R5cGVzLnJlZHVjZSgodG90YWwsIHR5cGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1aWxkaW5nID0gQnVpbGRpbmdzQnlUeXBlW3R5cGVdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGV2ZWwgPSBwbGFuZXQuYnVpbGRpbmdzW3R5cGVdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29zdCA9IHRoaXMuZ2V0QWNjdW11bGF0aXZlQ29zdChsZXZlbCwgYnVpbGRpbmcpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbCArIHRoaXMuZ2V0UG9pbnRzKGNvc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbCArIHBvaW50cztcclxuICAgICAgICAgICAgICAgIH0sIDApO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVuc2UgKyBidWlsZGluZ3MgKyBwaGFsYW54ZXNBbmRKdW1wR2F0ZXMgLyAyICsgY2l2aWxTaGlwcyAvIDI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGdldE1pbGl0YXJ5UG9pbnRzKCk6IG51bWJlciB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRlZmVuc2UgPSB0aGlzLnBsYW5ldHMucmVkdWNlKCh0b3RhbCwgcGxhbmV0KSA9PiB0b3RhbCArIHRoaXMuZ2V0RGVmZW5zZVBvaW50cyhwbGFuZXQpLCAwKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHBoYWxhbnhlc0FuZEp1bXBHYXRlcyA9ICh0aGlzLnBsYW5ldEFuZE1vb25zLmZpbHRlcihwID0+IHAuaXNNb29uKSBhcyBNb29uRGF0YVtdKVxyXG4gICAgICAgICAgICAgICAgLnJlZHVjZSgodG90YWwsIG1vb24pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwaGFsYW54ID0gdGhpcy5nZXRBY2N1bXVsYXRpdmVDb3N0KG1vb24uYnVpbGRpbmdzW0J1aWxkaW5nVHlwZS5zZW5zb3JQaGFsYW54XSwgU2Vuc29yUGhhbGFueCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QganVtcEdhdGUgPSB0aGlzLmdldEFjY3VtdWxhdGl2ZUNvc3QobW9vbi5idWlsZGluZ3NbQnVpbGRpbmdUeXBlLmp1bXBHYXRlXSwgU2Vuc29yUGhhbGFueCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvaW50cyA9IHRoaXMuZ2V0UG9pbnRzKHBoYWxhbngpICsgdGhpcy5nZXRQb2ludHMoanVtcEdhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbCArIHBvaW50cztcclxuICAgICAgICAgICAgICAgIH0sIDApO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbWlsaXRhcnlTaGlwVHlwZXMgPSBOb25TdGF0aW9uYXJ5U2hpcFR5cGVzLmZpbHRlcihzaGlwVHlwZSA9PiAoTWlsaXRhcnlTaGlwVHlwZXMgYXMgU2hpcFR5cGVbXSkuaW5jbHVkZXMoc2hpcFR5cGUpKTtcclxuICAgICAgICAgICAgY29uc3QgbWlsaXRhcnlTaGlwcyA9IHRoaXMucGxhbmV0QW5kTW9vbnMucmVkdWNlKCh0b3RhbCwgcGxhbmV0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcG9pbnRzOiBudW1iZXI7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHBsYW5ldC5pc01vb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSBNb29uU2hpcFR5cGVzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoc2hpcCA9PiAoTWlsaXRhcnlTaGlwVHlwZXMgYXMgU2hpcFR5cGVbXSkuaW5jbHVkZXMoc2hpcCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZWR1Y2UoKHRvdGFsLCBzaGlwVHlwZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2hpcCA9IFNoaXBCeVR5cGVzW3NoaXBUeXBlXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvc3QgPSBtdWx0aXBseUNvc3Qoc2hpcC5jb3N0LCBwbGFuZXQuc2hpcHNbc2hpcFR5cGVdKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG90YWwgKyB0aGlzLmdldFBvaW50cyhjb3N0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSBQbGFuZXRTaGlwVHlwZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihzaGlwID0+IChNaWxpdGFyeVNoaXBUeXBlcyBhcyBTaGlwVHlwZVtdKS5pbmNsdWRlcyhzaGlwKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlZHVjZSgodG90YWwsIHNoaXBUeXBlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzaGlwID0gU2hpcEJ5VHlwZXNbc2hpcFR5cGVdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29zdCA9IG11bHRpcGx5Q29zdChzaGlwLmNvc3QsIHBsYW5ldC5zaGlwc1tzaGlwVHlwZV0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbCArIHRoaXMuZ2V0UG9pbnRzKGNvc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdG90YWwgKyBwb2ludHM7XHJcbiAgICAgICAgICAgIH0sIDApICsgdGhpcy5vd25SZXR1cm5pbmdGbGVldHMucmVkdWNlKCh0b3RhbCwgZmxlZXQpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBvaW50cyA9IG1pbGl0YXJ5U2hpcFR5cGVzLnJlZHVjZSgodG90YWwsIHNoaXBUeXBlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY291bnQgPSBmbGVldC5zaGlwc1tzaGlwVHlwZV07XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2hpcCA9IFNoaXBCeVR5cGVzW3NoaXBUeXBlXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29zdCA9IG11bHRpcGx5Q29zdChzaGlwLmNvc3QsIGNvdW50KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG90YWwgKyB0aGlzLmdldFBvaW50cyhjb3N0KTtcclxuICAgICAgICAgICAgICAgIH0sIDApO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbCArIHBvaW50cztcclxuICAgICAgICAgICAgfSwgMCk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBjaXZpbFNoaXBUeXBlcyA9IE5vblN0YXRpb25hcnlTaGlwVHlwZXMuZmlsdGVyKHNoaXBUeXBlID0+IChDaXZpbFNoaXBUeXBlcyBhcyBTaGlwVHlwZVtdKS5pbmNsdWRlcyhzaGlwVHlwZSkpO1xyXG4gICAgICAgICAgICBjb25zdCBjaXZpbFNoaXBzID0gdGhpcy5wbGFuZXRBbmRNb29ucy5yZWR1Y2UoKHRvdGFsLCBwbGFuZXQpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBwb2ludHM6IG51bWJlcjtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocGxhbmV0LmlzTW9vbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IE1vb25TaGlwVHlwZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihzaGlwID0+IChDaXZpbFNoaXBUeXBlcyBhcyBTaGlwVHlwZVtdKS5pbmNsdWRlcyhzaGlwKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlZHVjZSgodG90YWwsIHNoaXBUeXBlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzaGlwID0gU2hpcEJ5VHlwZXNbc2hpcFR5cGVdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29zdCA9IG11bHRpcGx5Q29zdChzaGlwLmNvc3QsIHBsYW5ldC5zaGlwc1tzaGlwVHlwZV0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbCArIHRoaXMuZ2V0UG9pbnRzKGNvc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IFBsYW5ldFNoaXBUeXBlc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKHNoaXAgPT4gKENpdmlsU2hpcFR5cGVzIGFzIFNoaXBUeXBlW10pLmluY2x1ZGVzKHNoaXApKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVkdWNlKCh0b3RhbCwgc2hpcFR5cGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNoaXAgPSBTaGlwQnlUeXBlc1tzaGlwVHlwZV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3N0ID0gbXVsdGlwbHlDb3N0KHNoaXAuY29zdCwgcGxhbmV0LnNoaXBzW3NoaXBUeXBlXSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvdGFsICsgdGhpcy5nZXRQb2ludHMoY29zdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbCArIHBvaW50cztcclxuICAgICAgICAgICAgfSwgMCkgKyB0aGlzLm93blJldHVybmluZ0ZsZWV0cy5yZWR1Y2UoKHRvdGFsLCBmbGVldCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcG9pbnRzID0gY2l2aWxTaGlwVHlwZXMucmVkdWNlKCh0b3RhbCwgc2hpcFR5cGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3VudCA9IGZsZWV0LnNoaXBzW3NoaXBUeXBlXTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzaGlwID0gU2hpcEJ5VHlwZXNbc2hpcFR5cGVdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3N0ID0gbXVsdGlwbHlDb3N0KHNoaXAuY29zdCwgY291bnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbCArIHRoaXMuZ2V0UG9pbnRzKGNvc3QpO1xyXG4gICAgICAgICAgICAgICAgfSwgMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRvdGFsICsgcG9pbnRzO1xyXG4gICAgICAgICAgICB9LCAwKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlbnNlICsgcGhhbGFueGVzQW5kSnVtcEdhdGVzIC8gMiArIG1pbGl0YXJ5U2hpcHMgKyBjaXZpbFNoaXBzIC8gMjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgZ2V0IHBsYW5ldFBvaW50RGlzdHJpYnV0aW9ucygpOiBQbGFuZXRQb2ludERpc3RyaWJ1dGlvbkl0ZW1bXSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBsYW5ldHMubWFwPFBsYW5ldFBvaW50RGlzdHJpYnV0aW9uSXRlbT4ocGxhbmV0ID0+ICh7XHJcbiAgICAgICAgICAgICAgICBwbGFuZXRJZDogcGxhbmV0LmlkLFxyXG5cclxuICAgICAgICAgICAgICAgIGJ1aWxkaW5nczogdGhpcy5nZXRQbGFuZXRCdWlsZGluZ1BvaW50cyhwbGFuZXQpLFxyXG5cclxuICAgICAgICAgICAgICAgIGxpZmVmb3JtQnVpbGRpbmdzQWN0aXZlOiB0aGlzLmdldE90aGVyTGlmZWZvcm1CdWlsZGluZ1BvaW50cyhwbGFuZXQsIHRydWUpLFxyXG4gICAgICAgICAgICAgICAgbGlmZWZvcm1CdWlsZGluZ3NJbmFjdGl2ZTogdGhpcy5nZXRPdGhlckxpZmVmb3JtQnVpbGRpbmdQb2ludHMocGxhbmV0LCBmYWxzZSksXHJcbiAgICAgICAgICAgICAgICBsaWZlZm9ybVRlY2hub2xvZ2llc0FjdGl2ZTogdGhpcy5nZXRMaWZlZm9ybVRlY2hub2xvZ3lQb2ludHMocGxhbmV0LCB0cnVlKSxcclxuICAgICAgICAgICAgICAgIGxpZmVmb3JtVGVjaG5vbG9naWVzSW5hY3RpdmU6IHRoaXMuZ2V0TGlmZWZvcm1UZWNobm9sb2d5UG9pbnRzKHBsYW5ldCwgZmFsc2UpLFxyXG5cclxuICAgICAgICAgICAgICAgIGRlZmVuc2U6IHRoaXMuZ2V0RGVmZW5zZVBvaW50cyhwbGFuZXQpLFxyXG4gICAgICAgICAgICAgICAgc2hpcHM6IHRoaXMuZ2V0UGxhbmV0U2hpcFBvaW50cyhwbGFuZXQpLFxyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGdldExpZmVmb3JtVGVjaG5vbG9neVBvaW50cyhwbGFuZXQ6IFBsYW5ldERhdGEsIGFjdGl2ZTogYm9vbGVhbik6IG51bWJlciB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpZmVmb3JtVGVjaG5vbG9neVR5cGVzID0gTGlmZWZvcm1UZWNobm9sb2d5VHlwZXMuZmlsdGVyKHR5cGUgPT4gcGxhbmV0LmFjdGl2ZUxpZmVmb3JtVGVjaG5vbG9naWVzLmluY2x1ZGVzKHR5cGUpID09IGFjdGl2ZSk7XHJcblxyXG4gICAgICAgICAgICBsZXQgY29zdDogQ29zdCA9IHsgbWV0YWw6IDAsIGNyeXN0YWw6IDAsIGRldXRlcml1bTogMCwgZW5lcmd5OiAwIH07XHJcbiAgICAgICAgICAgIGxpZmVmb3JtVGVjaG5vbG9neVR5cGVzLmZvckVhY2goKHR5cGUpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRlY2hub2xvZ3kgPSBMaWZlZm9ybVRlY2hub2xvZ2llc0J5VHlwZVt0eXBlXTtcclxuICAgICAgICAgICAgICAgIGNvc3QgPSBhZGRDb3N0KGNvc3QsIHRoaXMuZ2V0QWNjdW11bGF0aXZlQ29zdChwbGFuZXQubGlmZWZvcm1UZWNobm9sb2dpZXNbdHlwZV0sIHRlY2hub2xvZ3kpKTtcclxuICAgICAgICAgICAgfSwgMCk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRQb2ludHMoY29zdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGdldCBtb29uUG9pbnREaXN0cmlidXRpb25zKCk6IE1vb25Qb2ludERpc3RyaWJ1dGlvbkl0ZW1bXSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vb25zID0gT2JqZWN0LnZhbHVlcyhFbXBpcmVEYXRhTW9kdWxlLmVtcGlyZS5wbGFuZXRzKS5maWx0ZXIocCA9PiBwLmlzTW9vbikgYXMgTW9vbkRhdGFbXTtcclxuICAgICAgICAgICAgcmV0dXJuIG1vb25zLm1hcDxNb29uUG9pbnREaXN0cmlidXRpb25JdGVtPihtb29uID0+ICh7XHJcbiAgICAgICAgICAgICAgICBtb29uSWQ6IG1vb24uaWQsXHJcblxyXG4gICAgICAgICAgICAgICAgYnVpbGRpbmdzOiB0aGlzLmdldE1vb25CdWlsZGluZ1BvaW50cyhtb29uKSxcclxuICAgICAgICAgICAgICAgIGRlZmVuc2U6IHRoaXMuZ2V0RGVmZW5zZVBvaW50cyhtb29uKSxcclxuICAgICAgICAgICAgICAgIHNoaXBzOiB0aGlzLmdldE1vb25TaGlwUG9pbnRzKG1vb24pLFxyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGdldCByZXNlYXJjaFBvaW50cygpOiBudW1iZXIge1xyXG4gICAgICAgICAgICBjb25zdCByZXNlYXJjaExldmVscyA9IEVtcGlyZURhdGFNb2R1bGUuZW1waXJlLnJlc2VhcmNoO1xyXG4gICAgICAgICAgICBsZXQgY29zdDogQ29zdCA9IHsgbWV0YWw6IDAsIGNyeXN0YWw6IDAsIGRldXRlcml1bTogMCwgZW5lcmd5OiAwIH07XHJcblxyXG4gICAgICAgICAgICBSZXNlYXJjaFR5cGVzLmZvckVhY2goKHJlc2VhcmNoVHlwZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzZWFyY2ggPSBSZXNlYXJjaEJ5VHlwZXNbcmVzZWFyY2hUeXBlXTtcclxuICAgICAgICAgICAgICAgIGNvc3QgPSBhZGRDb3N0KGNvc3QsIHRoaXMuZ2V0QWNjdW11bGF0aXZlQ29zdChyZXNlYXJjaExldmVsc1tyZXNlYXJjaFR5cGVdLCByZXNlYXJjaCkpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFBvaW50cyhjb3N0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgdG9OdW1iZXIodmFsdWU6IG51bWJlciB8IGJvb2xlYW4pOiBudW1iZXIge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSA/IDEgOiAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGdldERlZmVuc2VQb2ludHMocGxhbmV0OiBQbGFuZXREYXRhQmFzZSk6IG51bWJlciB7XHJcbiAgICAgICAgICAgIGxldCBjb3N0OiBDb3N0ID0geyBtZXRhbDogMCwgY3J5c3RhbDogMCwgZGV1dGVyaXVtOiAwLCBlbmVyZ3k6IDAgfTtcclxuXHJcbiAgICAgICAgICAgIERlZmVuc2VUeXBlcy5mb3JFYWNoKGRlZmVuc2VUeXBlID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy50b051bWJlcihwbGFuZXQuZGVmZW5zZVtkZWZlbnNlVHlwZV0pO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGVmZW5zZSA9IERlZmVuc2VCeVR5cGVzW2RlZmVuc2VUeXBlXTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCB0b3RhbENvc3QgPSBtdWx0aXBseUNvc3QoZGVmZW5zZS5jb3N0LCBjb3VudCk7XHJcbiAgICAgICAgICAgICAgICBjb3N0ID0gYWRkQ29zdChjb3N0LCB0b3RhbENvc3QpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFBvaW50cyhjb3N0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgZ2V0IG93blJldHVybmluZ0ZsZWV0cygpOiBGbGVldFtdIHtcclxuICAgICAgICAgICAgY29uc3QgZmxlZXRzID0gRW1waXJlRGF0YU1vZHVsZS5lbXBpcmUuZmxlZXRzO1xyXG4gICAgICAgICAgICBjb25zdCBwbGFuZXRzID0gdGhpcy5wbGFuZXRBbmRNb29ucztcclxuICAgICAgICAgICAgcmV0dXJuIGZsZWV0cy5maWx0ZXIoZmxlZXQgPT5cclxuICAgICAgICAgICAgICAgIChcclxuICAgICAgICAgICAgICAgICAgICBmbGVldC5pc1JldHVybkZsaWdodFxyXG4gICAgICAgICAgICAgICAgICAgIHx8IGZsZWV0Lm1pc3Npb24gPT0gRmxlZXRNaXNzaW9uVHlwZS5kZXBsb3ltZW50XHJcbiAgICAgICAgICAgICAgICApICYmIHBsYW5ldHMuc29tZShwID0+IGNvb3JkaW5hdGVzRXF1YWwocC5jb29yZGluYXRlcywgZmxlZXQub3JpZ2luQ29vcmRpbmF0ZXMpKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBnZXQgZmxlZXRzU2hpcFBvaW50cygpOiBudW1iZXIge1xyXG4gICAgICAgICAgICBsZXQgY29zdDogQ29zdCA9IHsgbWV0YWw6IDAsIGNyeXN0YWw6IDAsIGRldXRlcml1bTogMCwgZW5lcmd5OiAwIH07XHJcblxyXG4gICAgICAgICAgICB0aGlzLm93blJldHVybmluZ0ZsZWV0cy5mb3JFYWNoKGZsZWV0ID0+IHtcclxuICAgICAgICAgICAgICAgIE5vblN0YXRpb25hcnlTaGlwVHlwZXMuZm9yRWFjaChzaGlwVHlwZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY291bnQgPSBmbGVldC5zaGlwc1tzaGlwVHlwZV07XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2hpcCA9IFNoaXBCeVR5cGVzW3NoaXBUeXBlXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxDb3N0ID0gbXVsdGlwbHlDb3N0KHNoaXAuY29zdCwgY291bnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvc3QgPSBhZGRDb3N0KGNvc3QsIHRvdGFsQ29zdCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRQb2ludHMoY29zdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGdldFBsYW5ldFNoaXBQb2ludHMocGxhbmV0OiBQbGFuZXREYXRhKTogbnVtYmVyIHtcclxuICAgICAgICAgICAgbGV0IGNvc3Q6IENvc3QgPSB7IG1ldGFsOiAwLCBjcnlzdGFsOiAwLCBkZXV0ZXJpdW06IDAsIGVuZXJneTogMCB9O1xyXG5cclxuICAgICAgICAgICAgUGxhbmV0U2hpcFR5cGVzXHJcbiAgICAgICAgICAgICAgICAuZm9yRWFjaChzaGlwVHlwZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY291bnQgPSBwbGFuZXQuc2hpcHNbc2hpcFR5cGVdO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNoaXAgPSBTaGlwQnlUeXBlc1tzaGlwVHlwZV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsQ29zdCA9IG11bHRpcGx5Q29zdChzaGlwLmNvc3QsIGNvdW50KTtcclxuICAgICAgICAgICAgICAgICAgICBjb3N0ID0gYWRkQ29zdChjb3N0LCB0b3RhbENvc3QpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRQb2ludHMoY29zdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGdldE1vb25TaGlwUG9pbnRzKG1vb246IE1vb25EYXRhKTogbnVtYmVyIHtcclxuICAgICAgICAgICAgbGV0IGNvc3Q6IENvc3QgPSB7IG1ldGFsOiAwLCBjcnlzdGFsOiAwLCBkZXV0ZXJpdW06IDAsIGVuZXJneTogMCB9O1xyXG5cclxuICAgICAgICAgICAgTW9vblNoaXBUeXBlc1xyXG4gICAgICAgICAgICAgICAgLmZvckVhY2goc2hpcFR5cGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gbW9vbi5zaGlwc1tzaGlwVHlwZV07XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2hpcCA9IFNoaXBCeVR5cGVzW3NoaXBUeXBlXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxDb3N0ID0gbXVsdGlwbHlDb3N0KHNoaXAuY29zdCwgY291bnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvc3QgPSBhZGRDb3N0KGNvc3QsIHRvdGFsQ29zdCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFBvaW50cyhjb3N0KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwcml2YXRlIGdldE90aGVyTGlmZWZvcm1CdWlsZGluZ1BvaW50cyhwbGFuZXQ6IFBsYW5ldERhdGEsIGFjdGl2ZTogYm9vbGVhbik6IG51bWJlciB7XHJcbiAgICAgICAgICAgIGNvbnN0IGFsbExpZmVmb3JtQnVpbGRpbmdUeXBlcyA9IGFjdGl2ZVxyXG4gICAgICAgICAgICAgICAgPyBMaWZlZm9ybUJ1aWxkaW5nVHlwZXNCeUxpZmVmb3JtW3BsYW5ldC5hY3RpdmVMaWZlZm9ybV1cclxuICAgICAgICAgICAgICAgIDogTGlmZWZvcm1CdWlsZGluZ1R5cGVzLmZpbHRlcihiID0+ICFMaWZlZm9ybUJ1aWxkaW5nVHlwZXNCeUxpZmVmb3JtW3BsYW5ldC5hY3RpdmVMaWZlZm9ybV0uaW5jbHVkZXMoYikpO1xyXG4gICAgICAgICAgICBjb25zdCBleGNsdWRlID0gUmVzb3VyY2VQcm9kdWN0aW9uQm9udXNMaWZlZm9ybUJ1aWxkaW5ncy5tYXAoYiA9PiBiLnR5cGUpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbGZCdWlsZGluZ1R5cGVzID0gYWxsTGlmZWZvcm1CdWlsZGluZ1R5cGVzLmZpbHRlcih0eXBlID0+ICFleGNsdWRlLmluY2x1ZGVzKHR5cGUpKTtcclxuXHJcbiAgICAgICAgICAgIGxldCBjb3N0OiBDb3N0ID0geyBtZXRhbDogMCwgY3J5c3RhbDogMCwgZGV1dGVyaXVtOiAwLCBlbmVyZ3k6IDAgfTtcclxuICAgICAgICAgICAgbGZCdWlsZGluZ1R5cGVzLmZvckVhY2goKHR5cGUpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJ1aWxkaW5nID0gTGlmZWZvcm1CdWlsZGluZ3NCeVR5cGVbdHlwZV07XHJcbiAgICAgICAgICAgICAgICBjb3N0ID0gYWRkQ29zdChjb3N0LCB0aGlzLmdldEFjY3VtdWxhdGl2ZUNvc3QocGxhbmV0LmxpZmVmb3JtQnVpbGRpbmdzW3R5cGVdLCBidWlsZGluZykpO1xyXG4gICAgICAgICAgICB9LCAwKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFBvaW50cyhjb3N0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgZ2V0QWNjdW11bGF0aXZlQ29zdChsZXZlbDogbnVtYmVyLCBidWlsZGFibGU6IHsgZ2V0Q29zdChsZXZlbDogbnVtYmVyKTogQ29zdCB9KTogQ29zdCB7XHJcbiAgICAgICAgICAgIGxldCBjb3N0OiBDb3N0ID0geyBtZXRhbDogMCwgY3J5c3RhbDogMCwgZGV1dGVyaXVtOiAwLCBlbmVyZ3k6IDAgfTtcclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGwgPSAxOyBsIDw9IGxldmVsOyBsKyspIHtcclxuICAgICAgICAgICAgICAgIGNvc3QgPSBhZGRDb3N0KGNvc3QsIGJ1aWxkYWJsZS5nZXRDb3N0KGwpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvc3Q7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGdldFBsYW5ldEJ1aWxkaW5nUG9pbnRzKHBsYW5ldDogUGxhbmV0RGF0YSk6IG51bWJlciB7XHJcbiAgICAgICAgICAgIGxldCBjb3N0OiBDb3N0ID0geyBtZXRhbDogMCwgY3J5c3RhbDogMCwgZGV1dGVyaXVtOiAwLCBlbmVyZ3k6IDAgfTtcclxuXHJcbiAgICAgICAgICAgIFBsYW5ldEJ1aWxkaW5nVHlwZXMuZm9yRWFjaCgobWluZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYnVpbGRpbmcgPSBCdWlsZGluZ3NCeVR5cGVbbWluZV07XHJcbiAgICAgICAgICAgICAgICBjb3N0ID0gYWRkQ29zdChjb3N0LCB0aGlzLmdldEFjY3VtdWxhdGl2ZUNvc3QocGxhbmV0LmJ1aWxkaW5nc1ttaW5lXSwgYnVpbGRpbmcpKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRQb2ludHMoY29zdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGdldE1vb25CdWlsZGluZ1BvaW50cyhtb29uOiBNb29uRGF0YSk6IG51bWJlciB7XHJcbiAgICAgICAgICAgIGxldCBjb3N0OiBDb3N0ID0geyBtZXRhbDogMCwgY3J5c3RhbDogMCwgZGV1dGVyaXVtOiAwLCBlbmVyZ3k6IDAgfTtcclxuXHJcbiAgICAgICAgICAgIE1vb25CdWlsZGluZ1R5cGVzLmZvckVhY2goYnVpbGRpbmdUeXBlID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJ1aWxkaW5nID0gQnVpbGRpbmdzQnlUeXBlW2J1aWxkaW5nVHlwZV07XHJcbiAgICAgICAgICAgICAgICBjb3N0ID0gYWRkQ29zdChjb3N0LCB0aGlzLmdldEFjY3VtdWxhdGl2ZUNvc3QobW9vbi5idWlsZGluZ3NbYnVpbGRpbmdUeXBlXSwgYnVpbGRpbmcpKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRQb2ludHMoY29zdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGdldFBvaW50cyhjb3N0OiBDb3N0KTogbnVtYmVyIHtcclxuICAgICAgICAgICAgcmV0dXJuIChjb3N0Lm1ldGFsICsgY29zdC5jcnlzdGFsICsgY29zdC5kZXV0ZXJpdW0pIC8gMV8wMDA7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG48L3NjcmlwdD5cclxuIiwiaW1wb3J0IG1vZCBmcm9tIFwiLSEuLi8uLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvY2FjaGUtbG9hZGVyL2Rpc3QvY2pzLmpzPz9jbG9uZWRSdWxlU2V0LTQwWzBdLnJ1bGVzWzBdLnVzZVswXSEuLi8uLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvdGhyZWFkLWxvYWRlci9kaXN0L2Nqcy5qcyEuLi8uLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvdHMtbG9hZGVyL2luZGV4LmpzPz9jbG9uZWRSdWxlU2V0LTQwWzBdLnJ1bGVzWzBdLnVzZVsyXSEuLi8uLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvY2FjaGUtbG9hZGVyL2Rpc3QvY2pzLmpzPz9ydWxlU2V0WzBdLnJ1bGVzWzBdLnVzZVswXSEuLi8uLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvQHZ1ZS92dWUtbG9hZGVyLXYxNS9saWIvaW5kZXguanM/P3Z1ZS1sb2FkZXItb3B0aW9ucyEuL1BvaW50LURpc3RyaWJ1dGlvbi52dWU/dnVlJnR5cGU9c2NyaXB0Jmxhbmc9dHMmXCI7IGV4cG9ydCBkZWZhdWx0IG1vZDsgZXhwb3J0ICogZnJvbSBcIi0hLi4vLi4vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL2NhY2hlLWxvYWRlci9kaXN0L2Nqcy5qcz8/Y2xvbmVkUnVsZVNldC00MFswXS5ydWxlc1swXS51c2VbMF0hLi4vLi4vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL3RocmVhZC1sb2FkZXIvZGlzdC9janMuanMhLi4vLi4vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL3RzLWxvYWRlci9pbmRleC5qcz8/Y2xvbmVkUnVsZVNldC00MFswXS5ydWxlc1swXS51c2VbMl0hLi4vLi4vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL2NhY2hlLWxvYWRlci9kaXN0L2Nqcy5qcz8/cnVsZVNldFswXS5ydWxlc1swXS51c2VbMF0hLi4vLi4vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0B2dWUvdnVlLWxvYWRlci12MTUvbGliL2luZGV4LmpzPz92dWUtbG9hZGVyLW9wdGlvbnMhLi9Qb2ludC1EaXN0cmlidXRpb24udnVlP3Z1ZSZ0eXBlPXNjcmlwdCZsYW5nPXRzJlwiIiwiaW1wb3J0IHsgcmVuZGVyLCBzdGF0aWNSZW5kZXJGbnMgfSBmcm9tIFwiLi9Qb2ludC1EaXN0cmlidXRpb24udnVlP3Z1ZSZ0eXBlPXRlbXBsYXRlJmlkPTE2ODU0MzJjJlwiXG5pbXBvcnQgc2NyaXB0IGZyb20gXCIuL1BvaW50LURpc3RyaWJ1dGlvbi52dWU/dnVlJnR5cGU9c2NyaXB0Jmxhbmc9dHMmXCJcbmV4cG9ydCAqIGZyb20gXCIuL1BvaW50LURpc3RyaWJ1dGlvbi52dWU/dnVlJnR5cGU9c2NyaXB0Jmxhbmc9dHMmXCJcblxuXG4vKiBub3JtYWxpemUgY29tcG9uZW50ICovXG5pbXBvcnQgbm9ybWFsaXplciBmcm9tIFwiIS4uLy4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9AdnVlL3Z1ZS1sb2FkZXItdjE1L2xpYi9ydW50aW1lL2NvbXBvbmVudE5vcm1hbGl6ZXIuanNcIlxudmFyIGNvbXBvbmVudCA9IG5vcm1hbGl6ZXIoXG4gIHNjcmlwdCxcbiAgcmVuZGVyLFxuICBzdGF0aWNSZW5kZXJGbnMsXG4gIGZhbHNlLFxuICBudWxsLFxuICBudWxsLFxuICBudWxsXG4gIFxuKVxuXG5leHBvcnQgZGVmYXVsdCBjb21wb25lbnQuZXhwb3J0cyJdLCJuYW1lcyI6WyJjb21wYXJlQ29vcmRpbmF0ZXMiLCJhIiwiYiIsImtleXMiLCJrZXkiLCJkaWZmIiwiY29vcmRpbmF0ZXNFcXVhbCIsInJlbmRlciIsIl92bSIsInRoaXMiLCJfaCIsIiRjcmVhdGVFbGVtZW50IiwiX2MiLCJfc2VsZiIsInN0YXRpY0NsYXNzIiwiYXR0cnMiLCJjb2x1bW5zIiwiaXRlbXMiLCJmb290ZXJJdGVtcyIsInNjb3BlZFNsb3RzIiwiX3UiLCJmbiIsInJlZiIsInZhbHVlIiwiaGlnaHNjb3JlSXRlbXMiLCJoaWdoc2NvcmVGb290ZXJJdGVtcyIsInN0YXRpY1JlbmRlckZucyIsImNvbXBvbmVudCJdLCJzb3VyY2VSb290IjoiIn0=